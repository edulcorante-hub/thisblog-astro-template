---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Project from "../../components/Project.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  // Ordiniamo anche qui, così l'ordine delle pagine resta coerente
  const allProjects = (await getCollection("projects")).sort(
    (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  const projectsPerPage = 5;
  const totalPages = Math.ceil(allProjects.length / projectsPerPage);

  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
  }));
}

const allProjects = (await getCollection("projects")).sort(
  (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);


const projectsPerPage = 5;
const currentPage = Number(Astro.params.page);
const start = (currentPage - 1) * projectsPerPage;
const pageProjects = allProjects.slice(start, start + projectsPerPage);


const totalPages = Math.ceil(allProjects.length / projectsPerPage);
---
<BaseLayout title="Blog">
    <h1 class="text-xl font-bold">Project list</h1>
<ul>
  {pageProjects.map(project => (
    <Project
      url={`/projects/${project.id}/`}
      title={project.data.title}
      description={project.data.description}
      date={project.data.pubDate}
      stack={project.data.stack}
      categories={project.data.categories}
    />
  ))}
</ul>
<nav class="flex justify-center gap-2 mt-6">
  {currentPage > 1 && (
    <a href={`/projects/${currentPage - 1}/`} class="px-3 py-1 ...">← Prev</a>
  )}

  {Array.from({ length: totalPages }).map((_, i) => {
    const n = i + 1;
    const isActive = n === currentPage;
    return (
      <a href={`/projects/${n}/`} class={`px-3 py-1 ... ${isActive ? 'font-bold' : ''}`}>{n}</a>
    );
  })}

  {currentPage < totalPages && (
    <a href={`/projects/${currentPage + 1}/`} class="px-3 py-1 ...">Next →</a>
  )}
</nav>
